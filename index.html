<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Genesis AI Chat</title>
<style>
:root {
  --bg: #f5f5f5;
  --text: #111;
  --sidebar: #fff;
  --chat-bg: #fff;
  --input-bg: #fafafa;
  --border: #ddd;
  --primary: #10a37f;
  --user-msg: #d1f7c4;
  --active-chat: #e6e6e6;
}

body.dark {
  --bg: #1e1e1e;
  --text: #f1f1f1;
  --sidebar: #2b2b2b;
  --chat-bg: #262626;
  --input-bg: #333;
  --border: #444;
  --user-msg: #2f855a;
  --active-chat: #3a3a3a;
}

body {
  margin: 0;
  font-family: "Inter", sans-serif;
  background: var(--bg);
  color: var(--text);
  display: flex;
  height: 100vh;
  overflow: hidden;
}

/* Sidebar */
.sidebar {
  width: 280px;
  background: var(--sidebar);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
}

.sidebar-header {
  padding: 12px;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 6px;
}

.sidebar-header button {
  background: var(--primary);
  border: none;
  color: #fff;
  padding: 6px 12px;
  border-radius: 8px;
  cursor: pointer;
}

.chat-list {
  flex: 1;
  overflow-y: auto;
  list-style: none;
  margin: 0;
  padding: 0;
}

.chat-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 14px;
  border-bottom: 1px solid var(--border);
  cursor: pointer;
  transition: background 0.2s;
}

.chat-item:hover {
  background: rgba(0,0,0,0.05);
}

.chat-item.active {
  background: var(--active-chat);
}

.chat-item span {
  flex: 1;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}

.chat-options {
  position: relative;
}

.chat-options button {
  background: none;
  border: none;
  color: var(--text);
  font-size: 18px;
  cursor: pointer;
}

.dropdown {
  position: absolute;
  right: 0;
  top: 25px;
  background: var(--sidebar);
  border: 1px solid var(--border);
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.2);
  display: none;
  flex-direction: column;
  overflow: hidden;
  z-index: 10;
}

.dropdown button {
  background: none;
  border: none;
  text-align: left;
  padding: 8px 14px;
  width: 100%;
  cursor: pointer;
}

.dropdown button:hover {
  background: rgba(0,0,0,0.1);
}

/* Main Chat */
.chat-main {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.chat-header {
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 14px;
  border-bottom: 1px solid var(--border);
}

.chat-box {
  flex: 1;
  padding: 14px;
  overflow-y: auto;
  background: var(--chat-bg);
  display: flex;
  flex-direction: column;
}

/* Message Bubbles */
.message {
  margin-bottom: 16px;
  padding: 10px 14px;
  max-width: 75%;
  line-height: 1.5;
  border-radius: 16px;
  word-wrap: break-word;
  width: fit-content;
  display: inline-block;
  clear: both;
}

/* AI messages on the left */
.message.ai {
  float: left;
  border-bottom-left-radius: 4px;
  border-top-left-radius: 4px;
}

.message.user {
  background: var(--user-msg);
  color: #fff;
  align-self: flex-end;
  border-bottom-right-radius: 4px;
  border-top-right-radius: 4px;
  border-radius: 16px;
  padding: 10px 14px;
  max-width: 70%;
  line-height: 1.5;
  word-wrap: break-word;
  width: fit-content;
}

/* Error messages also on the left */
.message.error {
  color: #fff;
  background: #d32f2f;
  float: left;
  border-bottom-left-radius: 4px;
  border-top-left-radius: 4px;
}

/* Input Area */
.input-area {
  display: flex;
  padding: 10px;
  border-top: 1px solid var(--border);
  background: var(--input-bg);
}

.input-area input {
  flex: 1;
  padding: 10px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: var(--chat-bg);
  color: var(--text);
}

.input-area button {
  margin-left: 10px;
  background: var(--primary);
  border: none;
  color: #fff;
  padding: 0 18px;
  border-radius: 8px;
  cursor: pointer;
}

/* Modal Base */
.modal {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.4);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 100;
}

.modal-content {
  background: var(--sidebar);
  padding: 20px;
  border-radius: 12px;
  min-width: 300px;
  text-align: center;
}

.modal-content input {
  width: 90%;
  padding: 8px;
  margin-top: 10px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--chat-bg);
  color: var(--text);
}

.modal-actions {
  margin-top: 16px;
  display: flex;
  justify-content: center;
  gap: 10px;
}

.modal-actions button {
  padding: 8px 14px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
}

.modal-actions .confirm {
  background: var(--primary);
  color: #fff;
}

.modal-actions .cancel {
  background: #999;
  color: #fff;
}

/* Toggle (iPhone-style) */
.toggle {
  position: relative;
  display: inline-block;
  width: 52px;
  height: 28px;
  margin-right: 10px;
}

.toggle input { opacity: 0; width: 0; height: 0; }

.slider {
  position: absolute;
  cursor: pointer;
  inset: 0;
  background-color: #ccc;
  transition: .4s;
  border-radius: 34px;
}

.slider:before {
  position: absolute;
  content: "";
  height: 22px;
  width: 22px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

input:checked + .slider {
  background-color: var(--primary);
}

input:checked + .slider:before {
  transform: translateX(24px);
}
</style>
</head>
<body>
  <div class="sidebar">
    <div class="sidebar-header">
      <button id="newChatBtn">+ New Chat</button>
      <button id="settingsBtn">⚙️</button>
    </div>
    <ul id="chatList" class="chat-list"></ul>
  </div>

  <div class="chat-main">
    <div class="chat-header">
      <h3 id="chatTitle">New Chat</h3>
    </div>
    <div id="chatBox" class="chat-box"></div>
    <div class="input-area">
      <input type="text" id="userInput" placeholder="Type a message...">
      <button id="sendBtn">Send</button>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal">
    <div class="modal-content">
      <h2>Settings</h2>
      <label class="toggle">
        <input type="checkbox" id="themeToggle">
        <span class="slider"></span>
      </label>
      <span>Dark Mode</span>
    </div>
  </div>

  <!-- Rename Modal -->
  <div id="renameModal" class="modal">
    <div class="modal-content">
      <h2>Rename Chat</h2>
      <input type="text" id="renameInput">
      <div class="modal-actions">
        <button class="confirm" id="renameConfirm">Rename</button>
        <button class="cancel" id="renameCancel">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Delete Modal -->
  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <h2>Delete Chat?</h2>
      <p>This action cannot be undone.</p>
      <div class="modal-actions">
        <button class="confirm" id="deleteConfirm">Delete</button>
        <button class="cancel" id="deleteCancel">Cancel</button>
      </div>
    </div>
  </div>

<script>
const chatList = document.getElementById("chatList");
const chatBox = document.getElementById("chatBox");
const userInput = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");
const newChatBtn = document.getElementById("newChatBtn");
const settingsBtn = document.getElementById("settingsBtn");
const settingsModal = document.getElementById("settingsModal");
const themeToggle = document.getElementById("themeToggle");
const chatTitle = document.getElementById("chatTitle");

const renameModal = document.getElementById("renameModal");
const renameInput = document.getElementById("renameInput");
const renameConfirm = document.getElementById("renameConfirm");
const renameCancel = document.getElementById("renameCancel");

const deleteModal = document.getElementById("deleteModal");
const deleteConfirm = document.getElementById("deleteConfirm");
const deleteCancel = document.getElementById("deleteCancel");

let chats = JSON.parse(localStorage.getItem("chats") || "[]");
let activeChatId = localStorage.getItem("activeChatId");
let responses = {};
let currentRenameId = null;
let currentDeleteId = null;

fetch("https://xpdevs.github.io/Genisis-AI/reponses.json")
  .then(r => r.json())
  .then(data => responses = data)
  .catch(() => appendMessage("Failed to load responses.json", "error"));

function saveChats() {
  localStorage.setItem("chats", JSON.stringify(chats));
}

function updateURL(chatTitle) {
  const url = new URL(window.location);
  url.searchParams.set("chat", chatTitle);
  history.pushState({}, "", url);
}

function renderChatList() {
  chatList.innerHTML = "";
  chats.forEach(chat => {
    const li = document.createElement("li");
    li.className = "chat-item" + (chat.id === activeChatId ? " active" : "");
    const span = document.createElement("span");
    span.textContent = chat.title;

    const options = document.createElement("div");
    options.className = "chat-options";

    const dots = document.createElement("button");
    dots.textContent = "⋮";
    const dropdown = document.createElement("div");
    dropdown.className = "dropdown";
    const renameBtn = document.createElement("button");
    renameBtn.textContent = "Rename";
    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "Delete";

    renameBtn.onclick = e => {
      e.stopPropagation();
      currentRenameId = chat.id;
      renameInput.value = chat.title;
      renameModal.style.display = "flex";
      dropdown.style.display = "none";
    };
    deleteBtn.onclick = e => {
      e.stopPropagation();
      currentDeleteId = chat.id;
      deleteModal.style.display = "flex";
      dropdown.style.display = "none";
    };

    dropdown.append(renameBtn, deleteBtn);
    options.append(dots, dropdown);
    dots.onclick = e => {
      e.stopPropagation();
      dropdown.style.display = dropdown.style.display === "flex" ? "none" : "flex";
    };

    li.onclick = () => {
      activeChatId = chat.id;
      localStorage.setItem("activeChatId", activeChatId);
      renderChatList();
      renderMessages();
      updateURL(chat.title);
    };

    li.append(span, options);
    chatList.append(li);
  });
}

function renderMessages() {
  const chat = chats.find(c => c.id === activeChatId);
  chatTitle.textContent = chat ? chat.title : "New Chat";
  chatBox.innerHTML = "";
  if (!chat) return;
  chat.messages.forEach(msg => appendMessage(msg.text, msg.role));
  chatBox.scrollTop = chatBox.scrollHeight;
  if (chat) updateURL(chat.title);
}

function appendMessage(text, role) {
  const div = document.createElement("div");
  div.className = "message " + role;
  chatBox.append(div);
  chatBox.scrollTop = chatBox.scrollHeight;

  if (role === "ai") {
    // Type out AI message character by character
    let i = 0;
    const interval = setInterval(() => {
      div.textContent += text[i];
      i++;
      chatBox.scrollTop = chatBox.scrollHeight;
      if (i === text.length) clearInterval(interval);
    }, 30); // adjust speed here
  } else {
    // User or error messages appear instantly
    div.textContent = text;
  }

  chatBox.scrollTop = chatBox.scrollHeight;
}

function sendMessage() {
  const text = userInput.value.trim();
  if (!text) return;
  userInput.value = "";

  if (!activeChatId) {
    const newChat = { id: Date.now().toString(), title: "New Chat", messages: [] };
    chats.unshift(newChat);
    activeChatId = newChat.id;
    localStorage.setItem("activeChatId", activeChatId);
    saveChats();
    renderChatList();
  }

  const chat = chats.find(c => c.id === activeChatId);
  chat.messages.push({ role: "user", text });
  renderMessages();
  saveChats();

  const botMsg = findResponse(text);
  chat.messages.push(botMsg);
  renderMessages();
  saveChats();
}

function findResponse(input) {
  input = input.toLowerCase();
  const key = Object.keys(responses).find(k => input.includes(k.toLowerCase()));
  if (!key) return { role: "error", text: "Sorry, I couldn’t process that." };
  return { role: "ai", text: responses[key] };
}

renameCancel.onclick = () => renameModal.style.display = "none";
deleteCancel.onclick = () => deleteModal.style.display = "none";

renameConfirm.onclick = () => {
  const chat = chats.find(c => c.id === currentRenameId);
  if (chat && renameInput.value.trim()) {
    chat.title = renameInput.value.trim();
    saveChats();
    renderChatList();
    renderMessages();
    updateURL(chat.title);
  }
  renameModal.style.display = "none";
};

deleteConfirm.onclick = () => {
  chats = chats.filter(c => c.id !== currentDeleteId);
  if (activeChatId === currentDeleteId) {
    activeChatId = null;
    localStorage.removeItem("activeChatId");
    chatBox.innerHTML = "";
  }
  saveChats();
  renderChatList();
  deleteModal.style.display = "none";
};

newChatBtn.onclick = () => {
  if (activeChatId) saveChats();
  const newChat = { id: Date.now().toString(), title: "New Chat", messages: [] };
  chats.unshift(newChat);
  activeChatId = newChat.id;
  localStorage.setItem("activeChatId", activeChatId);
  saveChats();
  renderChatList();
  renderMessages();
  updateURL(newChat.title);
};

sendBtn.onclick = sendMessage;
userInput.addEventListener("keypress", e => e.key === "Enter" && sendMessage());
settingsBtn.onclick = () => settingsModal.style.display = "flex";
settingsModal.onclick = e => { if (e.target === settingsModal) settingsModal.style.display = "none"; };

themeToggle.checked = localStorage.getItem("theme") === "dark";
document.body.classList.toggle("dark", themeToggle.checked);

themeToggle.onchange = () => {
  document.body.classList.toggle("dark", themeToggle.checked);
  localStorage.setItem("theme", themeToggle.checked ? "dark" : "light");
};

// Load chat from URL on start
const urlParams = new URLSearchParams(window.location.search);
const chatParam = urlParams.get("chat");
if (chatParam) {
  const found = chats.find(c => c.title === chatParam);
  if (found) {
    activeChatId = found.id;
    localStorage.setItem("activeChatId", activeChatId);
  }
}

renderChatList();
renderMessages();
</script>
</body>
</html>
